resource "azapi_resource" "current" {
  type      = "Microsoft.Security/defenderForStorageSettings@2022-12-01-preview"
  name      = "current"
  parent_id = var.storage_account_id
  body = jsonencode({
    properties = {
      isEnabled = true
      malwareScanning = {
        onUpload = {
          capGBPerMonth = 100
          isEnabled     = true
        }
        scanResultsEventGridTopicResourceId = var.event_grid_topic_id
      }
      overrideSubscriptionLevelSettings = true
      sensitiveDataDiscovery = {
        isEnabled = false
      }
    }
  })
}

variable "storage_account_id" {

}

variable "event_grid_topic_id" {

}